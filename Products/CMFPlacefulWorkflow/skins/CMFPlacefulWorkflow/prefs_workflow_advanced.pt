<tal:block replace="nothing">
-*- coding: utf-8 -*-
## CMFPlacefulWorkflow
## Copyright (C)2005 Ingeniweb

## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2 of the License, or
## (at your option) any later version.

## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.

## You should have received a copy of the GNU General Public License
## along with this program; see the file COPYING. If not, write to the
## Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

Override plone prefs_workflow_advanced template for adding policy stuff

# $Source: /cvsroot/ingeniweb/CMFPlacefulWorkflow/skins/CMFPlacefulWorkflow/prefs_workflow_advanced.pt,v $
# $Id$
</tal:block>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="cmfplacefulworkflow">

    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border',1)" />

    <body>

        <div metal:fill-slot="prefs_configlet_main"
             tal:define="workflow_list wtool/listWorkflows;"
             class="configlet">

            <div id="content" class="documentEditable"
                 tal:condition="python:checkPermission('Manage users', here)">

                <!-- ugly way of simulating real actions on placeful workflow pages until we have real objects. -->
                <ul class="contentViews">
                    <li id="contentview-workflow-basic" class="plain">
                        <a href="prefs_workflow_basic"
                           i18n:translate="label_workflow_default">
                            Default workflow configuration
                        </a>
                    </li>
                    <li id="contentview-workflow-advanced" class="selected">
                        <a href="prefs_workflow_advanced"
                           i18n:translate="label_workflow_global_type_mapping">
                            Global Content Type to Workflow Mapping
                        </a>
                    </li>
                    <li id="contentview-workflow-localpolicies" class="plain">
                        <a href="prefs_workflow_localpolicies_form"
                           i18n:translate="label_workflow_local_type_mapping">
                            Local Content Type to Workflow Mapping
                        </a>
                    </li>
                </ul>

                <div class="contentActions">
                    &nbsp;
                </div>
                <!-- End of tabs -->

                <div class="documentContent" id="region-content">

                    <a name="documentContent"></a>

                    <div metal:use-macro="here/global_statusmessage/macros/portal_message">
                        Portal status message
                    </div>

                    <h1 i18n:translate="heading_workflow_setup">
                        Workflow Setup
                    </h1>

                    <a href=""
                       class="link-parent"
                       tal:attributes="href string: $portal_url/plone_control_panel"
                       i18n:domain="plone"
                       i18n:translate="label_up_to_plone_setup">
                        Up to Plone Setup
                    </a>

                    <p i18n:translate="description_workflow_setup">
                        Workflow setup for Plone.
                    </p>

                    <metal:block tal:condition="python:test(request.get('type_name', 'Select')!='Select', 1, 0)">
                        <tal:block tal:define="pps python:modules['Products.PythonScripts.standard'];
                                               type_name python:pps.url_quote(request.get('type_name'));" />
                    </metal:block>

                    <h1 i18n:translate="heading_workflow_global_type_mapping">
                        Global content type to workflow mapping
                    </h1>

                    <p i18n:translate="description_select_workflow_for_type">
                        Select the workflow you want for each content type.
                    </p>

                    <form name="change_workflow" 
                          action="prefs_workflow_advanced_edit" 
                          method="post">

                        <fieldset tal:define="allowedContentTypes allowedSortedContentTypes|here/allowedContentTypes">

                            <legend i18n:translate="legend_content_types">
                                Content types
                            </legend>

                            <div>
                            <table class="field">
                                <metal:ctype tal:repeat="ctype allowedContentTypes">
                                <tr tal:define="Title ctype/Title;
                                                Id ctype/getId;
                                                current_wf_list python:wtool.getChainForPortalType(Id)">

                                    <td valign="top">
                                        <img src=""
                                            alt=""
                                            width="16"
                                            height="16"
                                            tal:attributes="src string:$portal_url/${ctype/getIcon}" />

                                        <label tal:content="Title">Title</label>
                                    </td>

                                    <td valign="top">
                                        <div tal:repeat="current_wf current_wf_list">

                                            <select id="select_workflow"
                                                    name="workflow_id"
                                                    tabindex=""
                                                    alt=""
                                                    tal:attributes="name python:'wf.' + ctype.getId() + ':record'" >

                                                <option value="current"
                                                        tal:attributes="value current_wf">
                                                    <span tal:replace="current_wf"/>
                                                </option>

                                                <metal:block tal:repeat="wf workflow_list">
                                                    <option value="wf"
                                                            tal:attributes="value wf"
                                                            tal:content="wf"
                                                            i18n:translate="">
                                                        Simple workflow
                                                    </option>
                                                </metal:block>

                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                </metal:ctype>
                            </table>
                            </div>

                            <div class="formControls">
                                <input class="context"
                                       tabindex=""
                                       type="submit"
                                       name="Change"
                                       value="Save"
                                       i18n:domain="plone"
                                       i18n:attributes="value label_save;"
                                       tal:attributes="tabindex tabindex/next;" />
                            </div>

                        </fieldset>
                    </form>
                </div>
            </div>

            <div id="content" class="documentEditable"
                 tal:condition="python:not checkPermission('Manage users', here)">
                <tal:block replace="here/raiseUnauthorized" />
            </div>

        </div>
    </body>
</html>

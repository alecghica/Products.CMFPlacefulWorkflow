<tal:block replace="nothing">
-*- coding: utf-8 -*-
## CMFPlacefulWorkflow
## Copyright (C)2005 Ingeniweb

## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2 of the License, or
## (at your option) any later version.

## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.

## You should have received a copy of the GNU General Public License
## along with this program; see the file COPYING. If not, write to the
## Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

Workflow policy mapping template

# $Source: /cvsroot/ingeniweb/CMFPlacefulWorkflow/skins/CMFPlacefulWorkflow/prefs_workflow_policy_mapping.pt,v $
# $Id$
</tal:block>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="cmfplacefulworkflow">

<metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<body>

<div metal:fill-slot="prefs_configlet_main"
     tal:define="type_list python:here.portal_types.listTypeInfo();
                 type_list python: sequence.sort(type_list, (('Title', 'nocase', 'asc'),));
                 wfpid python:request.get('wfpid');
                 wf_policy python:here.portal_placeful_workflow.getWorkflowPolicyById(wfpid);
                 wf_list here/portal_workflow/objectIds">

<!-- ugly way of simulating real actions on the groups/user pages until we have
     real objects. -->

<ul tal:condition="python:0" id="contentTabs">
  <li class="selected">
    <a href="prefs_workflow_basic"
       i18n:translate="label_workflow_default">Default workflow configuration</a>
  </li>
  <li class="">
    <a href="prefs_workflow_advanced"
       i18n:translate="">Global Content Type to Workflow Mapping</a>
  </li>
  <li class="">
    <a href="prefs_workflow_localpolicies_form"
       i18n:translate="">Local Content Type to Workflow Mapping</a>
  </li>
</ul>
<div id="contentBar" tal:condition="python:0">&nbsp;</div>
<!-- End of tabs -->

<h1 i18n:translate=""><span tal:content="wfpid" /> <span tal:condition="python:wf_policy.getTitle()">(<span tal:content="python:wf_policy.getTitle()" />)</span></h1>

    <a href=""
       class="link-parent"
       tal:attributes="href string: $portal_url/prefs_workflow_localpolicies_form"
       i18n:translate="">
    Up to Placeful Workflow
    </a>

<p i18n:translate="">
    Custom workflow policy mapping content types to workflows.
</p>

<form name="prefs_workflow_policy_mapping_set" 
      action="prefs_workflow_policy_mapping_set"
      method="post">
    <fieldset>
        <legend i18n:translate="">Workflow Policy Details</legend>
        <div class="field">
            <label for="title" i18n:translate="label_title">Title</label>
            <span class="fieldRequired" title="Required"
                  i18n:attributes="title"
                  i18n:translate="label_required">(Required)</span>
            <br />
            <input type="text" id="title" name="title" value="" size="40"
                   tal:attributes="value python:request.get('title',wf_policy.getTitle())"/>
        </div>
        <div class="field">
            <label for="description" 
                   i18n:translate="label_description">Description</label>
            <div class="formHelp" i18n:translate="">
              A brief description of the workflow policy.
            </div>
            <textarea cols="80" rows="2" id="description" name="description"
                      tal:content="python:request.get('description',wf_policy.getDescription())">Workflow Policy Description.</textarea>
        </div>
        <div class="field">
            <label for="default_workflow_id" 
                   i18n:translate="label_description">Default Workflow</label>
            <div class="formHelp" i18n:translate="">
              Default workflow for content types.
            </div>
            <select id="select_workflow" name="default_workflow_id">
                <option tal:repeat="wf wf_list"
                        tal:attributes="value wf;
                                        selected python:test((wf,)==wf_policy.getDefaultChain(here), 'selected', None)"
                        tal:content="wf">example_workflow</option>
            </select>
        </div>
        <div  class="field">
            <label for="description" 
                   i18n:translate="">Workflows by type</label>
            <div class="formHelp" i18n:translate="">
              You can assign a workflow for all content type.
            </div>
            <table class="field">
                <metal:ctype tal:repeat="ctype type_list">
                    <tr tal:define="Title ctype/Title;
                                    Id ctype/getId;
                                    current_wf_list python:wf_policy.getChainFor(Id, managescreen=True)">
                        <td valign="top">
                            <img src="" alt="" width="16" height="16"
                                 tal:attributes="src string:$portal_url/${ctype/getIcon}" />
                            <label tal:content="Title">Title</label>
                        </td>
                        <td valign="top">
                            <div tal:define="chain python:wf_policy.getChainFor(ctype.getId(), managescreen=True)">
                                <select id="select_workflow" name="workflow_id" multiple="multiple"
                                        tal:attributes="name python:'wf.' + ctype.getId() + ':record';
                                                        multiple nothing;" >
                                    <option value=""></option>
                                    <option value="(Default)"
                                            tal:attributes="value string:(Default);
                                                            selected python:test('(Default)' == chain, 'selected', None);"
                                                            >(Default)</option>
                                    <option tal:repeat="wf wf_list"
                                            tal:attributes="value wf;
                                                            selected python:test(wf in chain, 'selected', None)"
                                            tal:content="wf">workflow_id</option>
                                </select>
                            </div>
                        </td>
                    </tr>
                </metal:ctype>
            </table>
            <input type="hidden" value="" name="wfpid" tal:attributes="value wfpid" />
        </div>
        <div class="formControls">
            <input class="context"
                   tabindex=""
                   type="submit"
                   name="submit"
                   value="Save"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;" />
        </div>
    </fieldset>
</form>

</div>

</body>
</html>
